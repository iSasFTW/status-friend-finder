<html>
    <head>
        <title>Find friends on Status!</title>
        <script src="https://use.fontawesome.com/87570cf17d.js"></script>
        <link href="styles.css" rel="stylesheet" type="text/css">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.16/clipboard.min.js"></script>

    </head>
    
    <body class="body">
        <div class="container">
            <div class="jumbotron" id="friendsMainLayout">
                <h2 class="title">Find friends!</h2>
                <br />
                <br />
                <br />
                <table class="table">
                    <thead>
                        <th>Username</th>
                        
                        <th>Public Key</th>
                        
                        <th>QR Code (click to show)</th>
                    </thead>

                    <tbody id="tablecontent">

                    </tbody>
                </table>
            </div>
        </div>
        
        
        <script type="text/javascript" src="kjua-0.1.1.min.js"></script>
        <script type="text/javascript" src="js.cookie.js"></script>
        <script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
        <script>
            var config = {
                apiKey: "AIzaSyAuGWK3aQiwgAZzkA4Z9NbqG6q8qJvr7AA",
                authDomain: "status-friend-finder.firebaseapp.com",
                databaseURL: "https://status-friend-finder.firebaseio.com",
                storageBucket: "status-friend-finder.appspot.com",
                messagingSenderId: "38615167502"
            };
            firebase.initializeApp(config);
            
            $(document).ready(function(){
                $('[data-toggle="tooltip"]').tooltip();   
            });
            
            
            firebase.database().ref("users").once("value", function(data) {
            data.forEach(function(snapshot) {
            $("#tablecontent").append("<tr id='"+snapshot.key+"'>" + 
                "<td class='word-break'>" + "<b>" + snapshot.child("username").val() + "</b>" + "</td>" +
                "<td class='word-break'>" + snapshot.child("publickey").val() + "</td>" +
                "<td>" + "<a id='btn"+snapshot.key+"'>Show QR Code</a>" + "<div id='qrcode"+snapshot.key+"' style='display: none;'></div>" + "</td>" + 
                "<td>" + "<button id='copybtn"+snapshot.key+"' class='btn copyButton' data-clipboard-text='"+snapshot.child("publickey").val()+"' data-toggle='tooltip' title='Copy public key to clipboard!'><span class='glyphicon glyphicon-copy'></span></button>" + "</td>" + 
                "<td>" + "<button id='markbtn"+snapshot.key+"' class='btn markButton' title='Mark as added!'><span class='glyphicon glyphicon-check'></span></button>" + "</td>" + 
                "</tr>");
                
                
                new Clipboard("#" + "copybtn" + snapshot.key);
                
                
                
                $("#" + "btn" + snapshot.key).click(function() {
                    $("#" + "qrcode" + snapshot.key).toggle();
                    $("#" + "qrcode" + snapshot.key).empty();
                    var qrcontent = kjua({text: snapshot.child("publickey").val()});
                    document.querySelector("#qrcode" + snapshot.key).appendChild(qrcontent);
                    
                    if($("#" + "btn" + snapshot.key).text() == "Show QR Code") {
                        $("#" + "btn" + snapshot.key).text("Hide QR Code");
                    } else {
                        $("#" + "btn" + snapshot.key).text("Show QR Code");
                    }
                });
                
                $("#" + "markbtn" + snapshot.key).click(function() {
                    $("#" + snapshot.key).toggleClass("marked");
                    if(Cookies.get(snapshot.key) == undefined) {
                        Cookies.set(snapshot.key, 'cookieset');
                        console.log("Cookie " + snapshot.key + " has been set!");
                    } else {
                        Cookies.remove(snapshot.key);
                        console.log("Cookie " + snapshot.key + " has been removed!");
                    }
                });

                if(Cookies.get(snapshot.key) == "cookieset") {
                    $("#" + snapshot.key).toggleClass("marked");
                }
                
                
            });
        });
            
        </script>
    </body>
</html>